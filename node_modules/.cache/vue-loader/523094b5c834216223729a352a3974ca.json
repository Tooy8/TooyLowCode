{"remainingRequest":"D:\\开源项目\\商城低代码\\mall-cook\\packages\\mall-cook-platform\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\开源项目\\商城低代码\\mall-cook\\packages\\mall-cook-platform\\src\\components\\MiniMCE\\plugins\\InsertWord\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\开源项目\\商城低代码\\mall-cook\\packages\\mall-cook-platform\\src\\components\\MiniMCE\\plugins\\InsertWord\\index.vue","mtime":1693619752153},{"path":"D:\\开源项目\\商城低代码\\mall-cook\\packages\\mall-cook-platform\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693619820390},{"path":"D:\\开源项目\\商城低代码\\mall-cook\\packages\\mall-cook-platform\\node_modules\\babel-loader\\lib\\index.js","mtime":1693619820336},{"path":"D:\\开源项目\\商城低代码\\mall-cook\\packages\\mall-cook-platform\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693619820390},{"path":"D:\\开源项目\\商城低代码\\mall-cook\\packages\\mall-cook-platform\\node_modules\\vue-loader\\lib\\index.js","mtime":1693619864566}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgbWFtbW90aCBmcm9tICdtYW1tb3RoL21hbW1vdGguYnJvd3Nlci5taW4uanMnDQoNCmV4cG9ydCBkZWZhdWx0IHsNCiAgcHJvcHM6IHsNCiAgICBlZGl0b3I6IHsNCiAgICAgIHJlcXVpcmVkOiB0cnVlLA0KICAgIH0NCiAgfSwNCiAgZGF0YSAoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHNob3c6IGZhbHNlLA0KICAgICAgZmlsZXM6IFtdLA0KICAgICAgbG9hZGluZzogZmFsc2UsDQogICAgICBhbGxTZXR0bGVkOiB0cnVlLA0KICAgIH0NCiAgfSwNCiAgd2F0Y2g6IHsNCiAgICBzaG93IChuKSB7DQogICAgICBpZiAoIW4pIHsNCiAgICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gew0KICAgICAgICAgIHRoaXMuZmlsZXMgPSBbXQ0KICAgICAgICB9KQ0KICAgICAgfQ0KICAgIH0NCiAgfSwNCiAgbWV0aG9kczogew0KICAgIG9wZW4gKCkgew0KICAgICAgdGhpcy5zaG93ID0gdHJ1ZQ0KICAgIH0sDQogICAgb25DaGFuZ2UgKGZpbGUsIGZpbGVMaXN0KSB7DQogICAgICB0aGlzLmZpbGVzID0gQXJyYXkuZnJvbShmaWxlTGlzdCwgKHsgcmF3IH0pID0+IHJhdykNCiAgICB9LA0KICAgIG9uUmVtb3ZlIChmaWxlLCBmaWxlTGlzdCkgew0KICAgICAgdGhpcy5maWxlcyA9IEFycmF5LmZyb20oZmlsZUxpc3QsICh7IHJhdyB9KSA9PiByYXcpDQogICAgfSwNCiAgICBhc3luYyBvblN1Ym1pdCAoKSB7DQogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlDQogICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKHRoaXMuZmlsZXMubWFwKHYgPT4NCiAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gew0KICAgICAgICAgIGlmICghdi5uYW1lLmVuZHNXaXRoKCcuZG9jeCcpKSB7DQogICAgICAgICAgICByZWplY3QoJ+S7heaUr+aMgSBkb2N4IOagvOW8jycpDQogICAgICAgICAgfQ0KDQogICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKQ0KICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBhc3luYyBlID0+IHsNCiAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gZS50YXJnZXQucmVzdWx0DQogICAgICAgICAgICBpZiAoYXJyYXlCdWZmZXIuYnl0ZUxlbmd0aCkgew0KICAgICAgICAgICAgICBtYW1tb3RoLmNvbnZlcnRUb0h0bWwoeyBhcnJheUJ1ZmZlciB9KS50aGVuKHJlcyA9PiB7DQogICAgICAgICAgICAgICAgY29uc3QgeyBtZXNzYWdlcywgdmFsdWUgfSA9IHJlcw0KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAke3YubmFtZX0g6Kej5p6Q57uT5p6c77yaYCwgcmVzKQ0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZSkgew0KICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZSkNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgcmVqZWN0KGAke3YubmFtZX0g5YaF5a655Li656m6YCkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pLmNhdGNoKGVyciA9PiB7DQogICAgICAgICAgICAgICAgcmVqZWN0KGVycikNCiAgICAgICAgICAgICAgfSkNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgIHJlamVjdChgJHt2Lm5hbWV9IOWGheWuueS4uuepumApDQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcih2KQ0KICAgICAgICB9KQ0KICAgICAgKSkNCg0KICAgICAgcmVzdWx0cy5tYXAocmVzdWx0ID0+IHsNCiAgICAgICAgY29uc3QgeyBzdGF0dXMsIHZhbHVlLCByZWFzb24gfSA9IHJlc3VsdA0KICAgICAgICBpZiAoc3RhdHVzID09PSAnZnVsZmlsbGVkJykgew0KICAgICAgICAgIHRoaXMuZWRpdG9yLmluc2VydENvbnRlbnQodmFsdWUpDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKHJlYXNvbikgew0KICAgICAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pDQogICAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKHR5cGVvZiByZWFzb24gPT09ICdzdHJpbmcnID8gcmVhc29uIDogJ+ino+aekOWksei0pScpDQogICAgICAgICAgfQ0KICAgICAgICAgIHRoaXMuYWxsU2V0dGxlZCA9IGZhbHNlDQogICAgICAgIH0NCiAgICAgIH0pDQoNCiAgICAgIHRoaXMuZmlsZXMgPSBbXQ0KICAgICAgdGhpcy4kcmVmcy5lbFVwbG9hZFJlZi5jbGVhckZpbGVzKCkNCiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlDQogICAgICBpZiAodGhpcy5hbGxTZXR0bGVkKSB7DQogICAgICAgIHRoaXMuc2hvdyA9IGZhbHNlDQogICAgICB9DQogICAgICB0aGlzLmFsbFNldHRsZWQgPSB0cnVlDQogICAgfQ0KICB9DQp9DQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/components/MiniMCE/plugins/InsertWord","sourcesContent":["<template>\r\n  <el-dialog\r\n    :visible=\"show\"\r\n    title=\"插入 Word 文档\"\r\n    append-to-body\r\n    destroy-on-close\r\n    :close-on-click-modal=\"false\"\r\n    @close=\"show=false\"\r\n  >\r\n    <el-upload\r\n      drag\r\n      action=\"\"\r\n      multiple\r\n      :auto-upload=\"false\"\r\n      :on-change=\"onChange\"\r\n      :on-remove=\"onRemove\"\r\n      style=\"width:100%;\"\r\n      ref=\"elUploadRef\"\r\n    >\r\n      <i class=\"el-icon-upload\"></i>\r\n      <div class=\"el-upload__text\">将 docx 文件拖到此处，或<em>点击上传</em></div>\r\n    </el-upload>\r\n\r\n    <template #footer>\r\n      <el-button @click=\"show=false\">取 消</el-button>\r\n      <el-button type=\"primary\" @click=\"onSubmit\" :loading=\"loading\" :disabled=\"!files.length\">确 定</el-button>\r\n    </template>\r\n  </el-dialog>\r\n</template>\r\n\r\n<script>\r\nimport mammoth from 'mammoth/mammoth.browser.min.js'\r\n\r\nexport default {\r\n  props: {\r\n    editor: {\r\n      required: true,\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      show: false,\r\n      files: [],\r\n      loading: false,\r\n      allSettled: true,\r\n    }\r\n  },\r\n  watch: {\r\n    show (n) {\r\n      if (!n) {\r\n        this.$nextTick(() => {\r\n          this.files = []\r\n        })\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    open () {\r\n      this.show = true\r\n    },\r\n    onChange (file, fileList) {\r\n      this.files = Array.from(fileList, ({ raw }) => raw)\r\n    },\r\n    onRemove (file, fileList) {\r\n      this.files = Array.from(fileList, ({ raw }) => raw)\r\n    },\r\n    async onSubmit () {\r\n      this.loading = true\r\n      const results = await Promise.allSettled(this.files.map(v =>\r\n        new Promise((resolve, reject) => {\r\n          if (!v.name.endsWith('.docx')) {\r\n            reject('仅支持 docx 格式')\r\n          }\r\n\r\n          const reader = new FileReader()\r\n          reader.onload = async e => {\r\n            const arrayBuffer = e.target.result\r\n            if (arrayBuffer.byteLength) {\r\n              mammoth.convertToHtml({ arrayBuffer }).then(res => {\r\n                const { messages, value } = res\r\n                console.log(`${v.name} 解析结果：`, res)\r\n                if (value) {\r\n                  resolve(value)\r\n                } else {\r\n                  reject(`${v.name} 内容为空`)\r\n                }\r\n              }).catch(err => {\r\n                reject(err)\r\n              })\r\n            } else {\r\n              reject(`${v.name} 内容为空`)\r\n            }\r\n          }\r\n          reader.readAsArrayBuffer(v)\r\n        })\r\n      ))\r\n\r\n      results.map(result => {\r\n        const { status, value, reason } = result\r\n        if (status === 'fulfilled') {\r\n          this.editor.insertContent(value)\r\n        } else {\r\n          if (reason) {\r\n            console.error(reason)\r\n            this.$message.error(typeof reason === 'string' ? reason : '解析失败')\r\n          }\r\n          this.allSettled = false\r\n        }\r\n      })\r\n\r\n      this.files = []\r\n      this.$refs.elUploadRef.clearFiles()\r\n      this.loading = false\r\n      if (this.allSettled) {\r\n        this.show = false\r\n      }\r\n      this.allSettled = true\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n::v-deep .el-dialog {\r\n  min-width: 600px;\r\n\r\n  & > .el-dialog__body {\r\n    display: flex;\r\n    justify-content: center;\r\n\r\n    .el-upload {\r\n      width: 100%;\r\n\r\n      & > .el-upload-dragger {\r\n        width: 100%;\r\n\r\n        .el-upload__text {\r\n          display: block !important;\r\n        }\r\n      }\r\n    }\r\n\r\n    .el-upload-list__item {\r\n      width: initial !important;\r\n      height: initial !important;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]}]}