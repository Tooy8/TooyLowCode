{"remainingRequest":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\src\\components\\Control\\ControlPanel.vue?vue&type=style&index=0&id=42c0bde9&lang=scss&scoped=true&","dependencies":[{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\src\\components\\Control\\ControlPanel.vue","mtime":1694493283594},{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\css-loader\\dist\\cjs.js","mtime":1693619861603},{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1693619864566},{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\px2rem-loader\\index.js","mtime":1693619901908},{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\postcss-loader\\src\\index.js","mtime":1693619864324},{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1693619903311},{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\sass-resources-loader\\lib\\loader.js","mtime":1693619810749},{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693619820390},{"path":"D:\\开源项目\\低代码\\Tooy-LowCode\\lowCode\\node_modules\\vue-loader\\lib\\index.js","mtime":1693619864566}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQoucGFuZWwgew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGxlZnQ6IDE3NnB4Ow0KICAvKm5vKi8NCiAgcmlnaHQ6IDM2MHB4Ow0KICAvKm5vKi8NCiAgaGVpZ2h0OiBjYWxjKDEwMCUgLSA1NnB4KTsNCiAgLypubyovDQogIG92ZXJmbG93OiBhdXRvOw0KDQogICY6Oi13ZWJraXQtc2Nyb2xsYmFyIHsNCiAgICBkaXNwbGF5OiBub25lOw0KICAgIC8qIENocm9tZSBTYWZhcmkgKi8NCiAgfQ0KDQogIC5wYW5lbC1zZXQgew0KICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICB0b3A6IDEwcHg7DQogICAgbGVmdDogLTcwcHg7DQogICAgd2lkdGg6IDQwcHg7DQogICAgaGVpZ2h0OiA0MHB4Ow0KICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICBiYWNrZ3JvdW5kOiAjZmZmOw0KICAgIGJveC1zaGFkb3c6IDAgMXB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMSk7DQogICAgY3Vyc29yOiBwb2ludGVyOw0KDQogICAgaSB7DQogICAgICBmb250LXNpemU6IDIycHg7DQogICAgICBjb2xvcjogI2IwYWZiMjsNCiAgICB9DQogIH0NCg0KICAucGFnZSB7DQogICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgIGZvbnQtc2l6ZTogMDsNCg0KICAgIC5wYWdlLWlmcmFtZSB7DQogICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICB3aWR0aDogMTAwJTsNCiAgICAgIHotaW5kZXg6IDEwOw0KICAgIH0NCg0KICAgIC5wYWdlLWxheWVyIHsNCiAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgIHRvcDogMDsNCiAgICAgIGxlZnQ6IDA7DQogICAgICB3aWR0aDogMTAwJTsNCiAgICAgIG1pbi1oZWlnaHQ6IDY2N3B4Ow0KICAgICAgLy8gYmFja2dyb3VuZDogY29ybmZsb3dlcmJsdWU7DQoNCiAgICAgIC5wYWdlLWxheWVyLXdpZGdldCB7DQogICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICB6LWluZGV4OiA5OTk5OTsNCiAgICAgIH0NCiAgICB9DQogIH0NCn0NCg=="},{"version":3,"sources":["ControlPanel.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ControlPanel.vue","sourceRoot":"src/components/Control","sourcesContent":["<!--\r\n * @Description: 面板\r\n\r\n-->\r\n<template>\r\n  <div class=\"panel\">\r\n    <phone-ctn>\r\n      <div class=\"page\">\r\n        <iframe v-if=\"initIframe\" ref=\"iframe\" class=\"page-iframe\" frameborder=\"no\" :style=\"{\r\n          height: iframeHeight + 'px',\r\n          pointerEvents: control.dragstatus ? 'none' : 'auto',\r\n        }\" :src=\"iframeUrl\" @load=\"init\"></iframe>\r\n\r\n        <!-- 拖拽与iframe交互蒙层 -->\r\n        <div class=\"page-layer\" type=\"page\" :style=\"{\r\n          height: iframeHeight + 'px',\r\n          zIndex: control.dragstatus ? '20' : '1',\r\n        }\" @dragover=\"layerMove\">\r\n          <control-widget-shape v-for=\"item in widgetInfoList\" :key=\"item.id\" :data=\"item\"\r\n            @changeCurrWidget=\"changeCurrWidget\">\r\n            <div ref=\"layerWidget\" class=\"page-layer-widget\" type=\"widget\" :id=\"item.id\"\r\n              :style=\"{ height: item.height + 'px' }\"></div>\r\n          </control-widget-shape>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- 页面设置 -->\r\n      <el-tooltip effect=\"light\" content=\"页面设置\" placement=\"bottom\">\r\n        <div class=\"panel-set flex-center\" @click=\"control.curWidget = undefined\">\r\n          <i class=\"el-icon-setting\"></i>\r\n        </div>\r\n      </el-tooltip>\r\n    </phone-ctn>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport ControlWidgetShape from \"./ControlWidgetShape.vue\";\r\nimport global from \"@/config/global\";\r\nimport { mapGetters, mapMutations } from \"vuex\";\r\n\r\nexport default {\r\n  components: { ControlWidgetShape },\r\n\r\n  inject: [\"control\"],\r\n\r\n  created() {\r\n    console.log(\"创建页面\");\r\n\r\n    this.initIframe = true;\r\n  },\r\n\r\n  mounted() {\r\n    this.control.h5Iframe = this.$refs.iframe;\r\n    this.getMessage();\r\n  },\r\n\r\n  destroyed() {\r\n    console.log(\"注销页面\");\r\n\r\n    this.initIframe = false;\r\n    window.removeEventListener(\"message\", this.getMessageHandle);\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      widgetInfoList: [],\r\n      iframeHeight: 667,\r\n      initIframe: false,\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    ...mapGetters([\"project\"]),\r\n\r\n    iframeUrl() {\r\n      return `${global.viewUrl}pages/build/build?operate=build`;\r\n    },\r\n  },\r\n\r\n  // 监听物料列表发生变化，通知iframe同步更新\r\n  watch: {\r\n    \"control.curPage.componentList\": {\r\n      handler() {\r\n        this.messageList();\r\n      },\r\n      deep: true,\r\n    },\r\n  },\r\n\r\n  methods: {\r\n    // 发送信息，同步初始化iframe\r\n    init() {\r\n      console.log(\"初始化...\");\r\n\r\n      this.messageInit();\r\n      this.messageList();\r\n    },\r\n\r\n    // 接收iframe信息\r\n    getMessage() {\r\n      window.addEventListener(\"message\", this.getMessageHandle);\r\n    },\r\n\r\n    getMessageHandle(e) {\r\n      let self = this;\r\n      let { type, params } = e.data;\r\n      switch (type) {\r\n        case \"setList\":\r\n          self.setList(params);\r\n          break;\r\n        case \"setHeight\":\r\n          self.setHeight(params);\r\n          break;\r\n        case \"setCurrWidget\":\r\n          self.setCurrWidget(params);\r\n          break;\r\n      }\r\n    },\r\n\r\n    // 设置页面高度\r\n    setHeight(params) {\r\n      this.widgetInfoList = params;\r\n      this.iframeHeight = this.widgetInfoList.reduce((a, b) => a + b.height, 0);\r\n      // console.log(`当前高度：${this.iframeHeight}`);\r\n    },\r\n\r\n    // iframe内物料列表发生变化，同步更新\r\n    setList(params) {\r\n      console.log(\" iframe内物料列表发生变化，同步更新\");\r\n      console.log(params);\r\n      console.log(this.control.curPage.name);\r\n\r\n      let { list } = params;\r\n      this.control.curPage.componentList = list;\r\n      console.log(this.project);\r\n    },\r\n\r\n    // 设置选中物料\r\n    setCurrWidget(params) {\r\n      let { id } = params;\r\n      this.control.curWidget = this.control.curPage.componentList.find(\r\n        (item) => id == item.id\r\n      );\r\n    },\r\n\r\n    // 修改选中物料，并通知iframe，同步更新\r\n    changeCurrWidget(widget) {\r\n      this.setCurrWidget(widget);\r\n      this.$refs.iframe.contentWindow.postMessage(\r\n        {\r\n          even: \"changeCurrWidget\",\r\n          params: { id: widget.id },\r\n        },\r\n        \"*\"\r\n      );\r\n    },\r\n\r\n    // 调用物料拖拽移动(节流)\r\n    layerMove(e, index) {\r\n      this.throttle(this.layerMoveFun, 1)(e, index);\r\n    },\r\n\r\n    // 物料拖拽移动,控制waiting移动\r\n    layerMoveFun(e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      console.log(\"物料拖拽移动,控制waiting移动\");\r\n\r\n      if (!this.control.dragstatus) return;\r\n\r\n      let type = e.target.getAttribute(\"type\");\r\n      let params = {\r\n        type: \"page\",\r\n      };\r\n\r\n      if (type == \"widget\") {\r\n        let [y, h] = [e.offsetY, e.target.offsetHeight];\r\n        params = {\r\n          id: e.target.getAttribute(\"id\"),\r\n          type: \"widget\",\r\n          direction: y < h / 2,\r\n        };\r\n      }\r\n\r\n      this.$refs.iframe.contentWindow.postMessage(\r\n        {\r\n          even: \"move\",\r\n          params,\r\n        },\r\n        \"*\"\r\n      );\r\n    },\r\n\r\n    // 发送信息，当前商城配置数据\r\n    messageInit() {\r\n      this.$refs.iframe.contentWindow.postMessage(\r\n        {\r\n          even: \"init\",\r\n          params: { project: this.project },\r\n        },\r\n        \"*\"\r\n      );\r\n    },\r\n\r\n    // 发送信息，同步iframe种物料数组\r\n    messageList() {\r\n      console.log(\"发送信息，同步iframe种物料数组\");\r\n      console.log(this.control.curPage);\r\n\r\n      console.log(this.control.curPage.componentList);\r\n\r\n      this.$refs.iframe.contentWindow.postMessage(\r\n        {\r\n          even: \"list\",\r\n          params: this.control.curPage.componentList,\r\n        },\r\n        \"*\"\r\n      );\r\n    },\r\n\r\n    // 节流\r\n    throttle(func, wait) {\r\n      let timeout;\r\n      return function () {\r\n        let context = this;\r\n        let args = arguments;\r\n        if (!timeout) {\r\n          timeout = setTimeout(() => {\r\n            timeout = null;\r\n            func.apply(context, args);\r\n          }, wait);\r\n        }\r\n      };\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.panel {\r\n  position: absolute;\r\n  left: 176px;\r\n  /*no*/\r\n  right: 360px;\r\n  /*no*/\r\n  height: calc(100% - 56px);\r\n  /*no*/\r\n  overflow: auto;\r\n\r\n  &::-webkit-scrollbar {\r\n    display: none;\r\n    /* Chrome Safari */\r\n  }\r\n\r\n  .panel-set {\r\n    position: absolute;\r\n    top: 10px;\r\n    left: -70px;\r\n    width: 40px;\r\n    height: 40px;\r\n    border-radius: 50%;\r\n    background: #fff;\r\n    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\r\n    cursor: pointer;\r\n\r\n    i {\r\n      font-size: 22px;\r\n      color: #b0afb2;\r\n    }\r\n  }\r\n\r\n  .page {\r\n    position: relative;\r\n    font-size: 0;\r\n\r\n    .page-iframe {\r\n      position: relative;\r\n      width: 100%;\r\n      z-index: 10;\r\n    }\r\n\r\n    .page-layer {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      min-height: 667px;\r\n      // background: cornflowerblue;\r\n\r\n      .page-layer-widget {\r\n        width: 100%;\r\n        z-index: 99999;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>"]}]}