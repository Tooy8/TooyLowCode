{"remainingRequest":"D:\\开源项目\\Tooy-LowCode\\lowCode\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\开源项目\\Tooy-LowCode\\lowCode\\src\\pages\\mall\\goods\\goods-manager\\edit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\开源项目\\Tooy-LowCode\\lowCode\\src\\pages\\mall\\goods\\goods-manager\\edit.vue","mtime":1693619752179},{"path":"D:\\开源项目\\Tooy-LowCode\\lowCode\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693619820390},{"path":"D:\\开源项目\\Tooy-LowCode\\lowCode\\node_modules\\babel-loader\\lib\\index.js","mtime":1693619820336},{"path":"D:\\开源项目\\Tooy-LowCode\\lowCode\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1693619820390},{"path":"D:\\开源项目\\Tooy-LowCode\\lowCode\\node_modules\\vue-loader\\lib\\index.js","mtime":1693619864566}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBtYXBHZXR0ZXJzIH0gZnJvbSAidnVleCI7DQppbXBvcnQgeyBhZGRHb29kcywgZWRpdEdvb2RzIH0gZnJvbSAiQC9hcGkvZ29vZHMiOw0KDQpleHBvcnQgZGVmYXVsdCB7DQogIGNyZWF0ZWQoKSB7DQogICAgbGV0IGZvcm0gPSB0aGlzLiRyb3V0ZS5wYXJhbXM7DQogICAgLy8g5Lu35qC85pS55Li65YWD6K6+572uDQogICAgZm9ybS5wcmljZSA9IGZvcm0ucHJpY2UgPyBmb3JtLnByaWNlIC8gMTAwIDogMDsNCiAgICBmb3JtLm9yaWdpbmFsUHJpY2UgPSBmb3JtLm9yaWdpbmFsUHJpY2UgPyBmb3JtLm9yaWdpbmFsUHJpY2UgLyAxMDAgOiAwOw0KICAgIHRoaXMuZm9ybSA9IGZvcm07DQogIH0sDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGZvcm06IHt9LA0KICAgIH07DQogIH0sDQogIGNvbXB1dGVkOiB7DQogICAgLi4ubWFwR2V0dGVycyhbInByb2plY3QiXSksDQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyDmj5DkuqQNCiAgICBzdWJtaXQoKSB7DQogICAgICB0aGlzLiRyZWZzWyJmb3JtIl0udmFsaWRhdGUoKHZhbGlkKSA9PiB7DQogICAgICAgIGlmICh2YWxpZCkgew0KICAgICAgICAgIHRoaXMuZm9ybS5pZCA/IHRoaXMuZWRpdCgpIDogdGhpcy5hZGQoKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSwNCg0KICAgIC8vIOaWsOWing0KICAgIGFzeW5jIGFkZCgpIHsNCiAgICAgIGxldCBkYXRhID0gdGhpcy5mb3JtYXRQYXJhbXMoew0KICAgICAgICBwcm9qZWN0SWQ6IHRoaXMucHJvamVjdC5pZCwNCiAgICAgICAgLi4udGhpcy5mb3JtLA0KICAgICAgfSk7DQoNCiAgICAgIGxldCB7IHN0YXR1cyB9ID0gYXdhaXQgYWRkR29vZHMoZGF0YSk7DQoNCiAgICAgIGlmIChzdGF0dXMgPT0gIjEwMDAwIikgew0KICAgICAgICB0aGlzLiRub3RpZnkoew0KICAgICAgICAgIHRpdGxlOiAi5oiQ5YqfIiwNCiAgICAgICAgICBtZXNzYWdlOiAi5ZWG5ZOB5Y+R5biD5oiQ5YqfIiwNCiAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsDQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaCh7IG5hbWU6ICJnb29kcy1tYW5hZ2VyIiB9KTsNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLy8g57yW6L6RDQogICAgYXN5bmMgZWRpdCgpIHsNCiAgICAgIGxldCB7IHN0YXR1cyB9ID0gYXdhaXQgZWRpdEdvb2RzKHRoaXMuZm9ybWF0UGFyYW1zKHRoaXMuZm9ybSkpOw0KDQogICAgICBpZiAoc3RhdHVzID09ICIxMDAwMCIpIHsNCiAgICAgICAgdGhpcy4kbm90aWZ5KHsNCiAgICAgICAgICB0aXRsZTogIuaIkOWKnyIsDQogICAgICAgICAgbWVzc2FnZTogIuWVhuWTgeS/ruaUueaIkOWKnyIsDQogICAgICAgICAgdHlwZTogInN1Y2Nlc3MiLA0KICAgICAgICB9KTsNCiAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goeyBuYW1lOiAiZ29vZHMtbWFuYWdlciIgfSk7DQogICAgICB9DQogICAgfSwNCg0KICAgIGZvcm1hdFBhcmFtcyh0YXJnZXQpIHsNCiAgICAgIGxldCBkYXRhID0gdGhpcy4kY2xvbmVEZWVwKHRhcmdldCk7DQogICAgICAvLyDku7fmoLzkuLrnu5/kuIDkuLrliIYNCiAgICAgIGRhdGEucHJpY2UgPSBkYXRhLnByaWNlICogMTAwOw0KICAgICAgZGF0YS5vcmlnaW5hbFByaWNlID0gZGF0YS5vcmlnaW5hbFByaWNlICogMTAwOw0KICAgICAgcmV0dXJuIGRhdGE7DQogICAgfSwNCiAgfSwNCn07DQo="},{"version":3,"sources":["edit.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2EA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"edit.vue","sourceRoot":"src/pages/mall/goods/goods-manager","sourcesContent":["<!--\r\n * @Description: What's this for\r\n * @Autor: WangYuan\r\n * @Date: 2021-08-17 10:18:09\r\n * @LastEditors: WangYuan\r\n * @LastEditTime: 2021-12-08 20:50:34\r\n-->\r\n<template>\r\n  <div class=\"m20 p20 bg-white\">\r\n    <el-form\r\n      label-position=\"right\"\r\n      label-width=\"120px\"\r\n      :model=\"form\"\r\n      ref=\"form\"\r\n      size=\"small\"\r\n      class=\"mb50\"\r\n    >\r\n      <el-form-item label=\"商品名：\" prop=\"name\" :verify=\"{ maxLen: 30 }\">\r\n        <el-input v-model=\"form.name\" style=\"width: 500px\"></el-input>\r\n        <div class=\"f12 f-grey\">商品名称，建议30字以内</div>\r\n      </el-form-item>\r\n      <el-form-item label=\"商品描述：\" prop=\"describe\" :verify=\"{ maxLen: 60 }\">\r\n        <el-input v-model=\"form.describe\" style=\"width: 500px\"></el-input>\r\n        <div class=\"f12 f-grey\">\r\n          在商品详情页标题下面展示卖点信息，建议60字以内\r\n        </div>\r\n      </el-form-item>\r\n      <el-form-item label=\"商品封面：\" prop=\"cover\" verify>\r\n        <Imgpond v-model=\"form.cover\" :count=\"1\" />\r\n        <div class=\"f12 f-grey\">建议尺寸：800*800像素</div>\r\n      </el-form-item>\r\n      <el-form-item label=\"商品图：\" prop=\"imgList\" verify>\r\n        <Imgpond v-model=\"form.imgList\" :count=\"10\" />\r\n        <div class=\"f12 f-grey\">\r\n          建议尺寸：800*800像素，你可以拖拽图片调整顺序，最多上传10张\r\n        </div>\r\n      </el-form-item>\r\n      <el-form-item\r\n        label=\"价格：\"\r\n        prop=\"price\"\r\n        :verify=\"{ gte: 0, type: '数字' }\"\r\n      >\r\n        <el-input v-model=\"form.price\" style=\"width: 150px\"></el-input>\r\n      </el-form-item>\r\n      <el-form-item\r\n        label=\"划线价：\"\r\n        prop=\"originalPrice\"\r\n        :verify=\"{ gte: 0, type: '数字' }\"\r\n      >\r\n        <el-input v-model=\"form.originalPrice\" style=\"width: 150px\"></el-input>\r\n      </el-form-item>\r\n      <!-- <el-form-item\r\n        label=\"库存：\"\r\n        prop=\"inventory\"\r\n        :verify=\"{gte:1,lte:10000,type:'数字'}\"\r\n      >\r\n        <el-input\r\n          v-model=\"form.inventory\"\r\n          style=\"width:150px\"\r\n        ></el-input>\r\n      </el-form-item> -->\r\n      <el-form-item label=\"商品详情：\">\r\n        <MiniMCE style=\"width: 800px\" v-model=\"form.richText\" />\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <div class=\"operation\">\r\n      <el-button size=\"small\" class=\"f-white bg-theme\" @click=\"submit()\"\r\n        >保存商品</el-button\r\n      >\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from \"vuex\";\r\nimport { addGoods, editGoods } from \"@/api/goods\";\r\n\r\nexport default {\r\n  created() {\r\n    let form = this.$route.params;\r\n    // 价格改为元设置\r\n    form.price = form.price ? form.price / 100 : 0;\r\n    form.originalPrice = form.originalPrice ? form.originalPrice / 100 : 0;\r\n    this.form = form;\r\n  },\r\n  data() {\r\n    return {\r\n      form: {},\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters([\"project\"]),\r\n  },\r\n  methods: {\r\n    // 提交\r\n    submit() {\r\n      this.$refs[\"form\"].validate((valid) => {\r\n        if (valid) {\r\n          this.form.id ? this.edit() : this.add();\r\n        }\r\n      });\r\n    },\r\n\r\n    // 新增\r\n    async add() {\r\n      let data = this.formatParams({\r\n        projectId: this.project.id,\r\n        ...this.form,\r\n      });\r\n\r\n      let { status } = await addGoods(data);\r\n\r\n      if (status == \"10000\") {\r\n        this.$notify({\r\n          title: \"成功\",\r\n          message: \"商品发布成功\",\r\n          type: \"success\",\r\n        });\r\n        this.$router.push({ name: \"goods-manager\" });\r\n      }\r\n    },\r\n\r\n    // 编辑\r\n    async edit() {\r\n      let { status } = await editGoods(this.formatParams(this.form));\r\n\r\n      if (status == \"10000\") {\r\n        this.$notify({\r\n          title: \"成功\",\r\n          message: \"商品修改成功\",\r\n          type: \"success\",\r\n        });\r\n        this.$router.push({ name: \"goods-manager\" });\r\n      }\r\n    },\r\n\r\n    formatParams(target) {\r\n      let data = this.$cloneDeep(target);\r\n      // 价格为统一为分\r\n      data.price = data.price * 100;\r\n      data.originalPrice = data.originalPrice * 100;\r\n      return data;\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.operation {\r\n  position: fixed;\r\n  bottom: 0px;\r\n  right: 20px;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 60px;\r\n  width: 1612px;\r\n  box-shadow: 0 -3px 5px #eee;\r\n  background: #fff;\r\n}\r\n</style>\r\n"]}]}